<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyze Resume | AI ResumeIQ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body class="dashboard-body">

<!-- ===== SIDEBAR ===== -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-brand">
        <i class="fas fa-brain text-purple"></i>
        <span class="gradient-text ms-2 fw-bold">ResumeIQ</span>
    </div>
    <nav class="sidebar-nav">
        <a href="/dashboard" class="sidebar-link">
            <i class="fas fa-home"></i><span>Dashboard</span>
        </a>
        <a href="/analyzer" class="sidebar-link active">
            <i class="fas fa-search"></i><span>Analyze Resume</span>
        </a>
        <a href="/analyzer#rank" class="sidebar-link">
            <i class="fas fa-trophy"></i><span>Rank Resumes</span>
        </a>
    </nav>
    <div class="sidebar-footer">
        <div class="user-info">
            <div class="user-avatar">{{ username[0].upper() }}</div>
            <div><div class="text-white small fw-semibold">{{ username }}</div></div>
        </div>
        <a href="/logout" class="btn btn-sm btn-outline-danger mt-2 w-100">
            <i class="fas fa-sign-out-alt me-1"></i>Logout
        </a>
    </div>
</div>

<!-- ===== MAIN CONTENT ===== -->
<div class="main-content" id="mainContent">
    <div class="topbar">
        <button class="btn btn-dark btn-sm me-3" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
        <h4 class="topbar-title mb-0">Resume Analyzer</h4>
    </div>

    <!-- ===== TAB NAVIGATION ===== -->
    <ul class="nav nav-pills mb-4 analyzer-tabs" id="analyzerTabs">
        <li class="nav-item">
            <button class="nav-link active" id="tab-single" onclick="switchTab('single')">
                <i class="fas fa-file-alt me-2"></i>Single Resume
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" id="tab-rank" onclick="switchTab('rank')">
                <i class="fas fa-trophy me-2"></i>Rank Multiple Resumes
            </button>
        </li>
    </ul>

    <!-- ===== SINGLE RESUME TAB ===== -->
    <div id="panel-single">
        <div class="row g-4">
            <!-- LEFT: Upload Form -->
            <div class="col-lg-5">
                <div class="card-dark">
                    <div class="card-dark-header">
                        <h6 class="mb-0"><i class="fas fa-upload me-2 text-purple"></i>Upload & Analyze</h6>
                    </div>
                    <div class="card-dark-body">

                        <!-- DRAG & DROP UPLOAD ZONE -->
                        <div class="upload-zone" id="uploadZone" onclick="document.getElementById('resumeFile').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">
                                <strong>Drag & drop your resume here</strong><br>
                                <span class="text-muted small">or click to browse files</span>
                            </div>
                            <div class="upload-hint">
                                <span class="badge bg-purple-soft me-1">PDF</span>
                                <span class="badge bg-purple-soft">DOCX</span>
                            </div>
                            <!-- Hidden file input -->
                            <input type="file" id="resumeFile" accept=".pdf,.docx,.doc" style="display:none">
                        </div>

                        <!-- File selected indicator -->
                        <div id="file-selected" class="file-selected-bar d-none mt-3">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span id="file-name">file.pdf</span>
                            <button class="btn btn-sm btn-danger ms-auto" onclick="removeFile()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>

                        <!-- Job Description -->
                        <div class="mt-4">
                            <label class="form-label text-white-50 small fw-semibold">
                                <i class="fas fa-briefcase me-1"></i>Paste Job Description *
                            </label>
                            <textarea id="jobDescription"
                                      class="form-control form-control-custom"
                                      rows="8"
                                      placeholder="Paste the full job description here...
Example:
We are looking for a Data Scientist with:
- 2+ years of Python experience
- Machine Learning (TensorFlow, Scikit-learn)
- SQL and data analysis skills
- Strong communication skills"></textarea>
                            <small class="text-muted">More detailed = more accurate results</small>
                        </div>

                        <!-- Analyze Button -->
                        <button class="btn btn-gradient w-100 mt-4 py-3 fw-semibold" id="analyzeBtn"
                                onclick="analyzeResume()">
                            <i class="fas fa-brain me-2"></i>Analyze with AI
                        </button>

                        <!-- Loading State -->
                        <div id="loading-state" class="text-center mt-3 d-none">
                            <div class="loading-animation">
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                                <div class="loading-dot"></div>
                            </div>
                            <p class="text-muted mt-2 small" id="loading-text">
                                Extracting text from resume...
                            </p>
                        </div>

                    </div>
                </div>
            </div>

            <!-- RIGHT: Results Panel -->
            <div class="col-lg-7" id="results-panel" style="display:none">

                <!-- ATS Score Card -->
                <div class="card-dark mb-4">
                    <div class="card-dark-body text-center py-4">
                        <h6 class="text-muted mb-3">
                            <i class="fas fa-gauge me-2"></i>Your ATS Score
                        </h6>
                        <!-- Animated progress bar -->
                        <div class="score-circle-container mb-3">
                            <canvas id="scoreGauge" width="200" height="200"></canvas>
                            <div class="score-overlay">
                                <div class="score-number" id="score-display">0</div>
                                <div class="score-label">/ 100</div>
                            </div>
                        </div>
                        <!-- Score bar -->
                        <div class="ats-bar-container mb-2">
                            <div class="ats-bar-fill" id="ats-bar" style="width:0%"></div>
                        </div>
                        <p id="score-message" class="text-muted small"></p>
                    </div>
                </div>

                <!-- Skills Charts Row -->
                <div class="row g-3 mb-4">
                    <!-- Skill Match Pie Chart -->
                    <div class="col-md-6">
                        <div class="card-dark h-100">
                            <div class="card-dark-header">
                                <h6 class="mb-0 small"><i class="fas fa-chart-pie me-2 text-purple"></i>Skill Match</h6>
                            </div>
                            <div class="card-dark-body text-center">
                                <canvas id="skillPieChart" width="180" height="180"></canvas>
                                <div id="skill-pie-legend" class="mt-2"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Similarity Score -->
                    <div class="col-md-6">
                        <div class="card-dark h-100">
                            <div class="card-dark-header">
                                <h6 class="mb-0 small"><i class="fas fa-equals me-2 text-blue"></i>Similarity</h6>
                            </div>
                            <div class="card-dark-body text-center">
                                <canvas id="simChart" width="180" height="180"></canvas>
                                <p class="text-muted small mt-2" id="sim-text"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Matched Skills -->
                <div class="card-dark mb-4">
                    <div class="card-dark-header">
                        <h6 class="mb-0"><i class="fas fa-check-circle me-2 text-success"></i>Matched Skills</h6>
                    </div>
                    <div class="card-dark-body">
                        <div id="matched-skills-container" class="skills-container"></div>
                    </div>
                </div>

                <!-- Missing Skills (Skill Gap) -->
                <div class="card-dark mb-4">
                    <div class="card-dark-header">
                        <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2 text-warning"></i>Skill Gap (Missing Skills)</h6>
                    </div>
                    <div class="card-dark-body">
                        <div id="missing-skills-container" class="skills-container"></div>
                    </div>
                </div>

                <!-- Career Recommendations -->
                <div class="card-dark mb-4">
                    <div class="card-dark-header">
                        <h6 class="mb-0"><i class="fas fa-compass me-2 text-purple"></i>AI Career Recommendations</h6>
                    </div>
                    <div class="card-dark-body">
                        <div id="career-container"></div>
                    </div>
                </div>

                <!-- Resume Tips -->
                <div class="card-dark mb-4">
                    <div class="card-dark-header">
                        <h6 class="mb-0"><i class="fas fa-lightbulb me-2 text-yellow"></i>Resume Improvement Tips</h6>
                    </div>
                    <div class="card-dark-body">
                        <div id="tips-container"></div>
                    </div>
                </div>

                <!-- Download Report Button -->
                <div class="text-center mb-4">
                    <button class="btn btn-gradient px-5 py-3" onclick="downloadReport()">
                        <i class="fas fa-file-pdf me-2"></i>Download PDF Report
                    </button>
                </div>

            </div><!-- end results-panel -->

        </div><!-- end row -->
    </div><!-- end panel-single -->


    <!-- ===== RANK MULTIPLE RESUMES TAB ===== -->
    <div id="panel-rank" style="display:none">
        <div class="row g-4">
            <div class="col-lg-5">
                <div class="card-dark">
                    <div class="card-dark-header">
                        <h6 class="mb-0"><i class="fas fa-trophy me-2 text-yellow"></i>Rank Multiple Resumes</h6>
                    </div>
                    <div class="card-dark-body">
                        <div class="upload-zone" onclick="document.getElementById('multipleFiles').click()">
                            <div class="upload-icon"><i class="fas fa-files"></i></div>
                            <div class="upload-text">
                                <strong>Upload Multiple Resumes</strong><br>
                                <span class="text-muted small">Select 2 or more PDF/DOCX files</span>
                            </div>
                            <input type="file" id="multipleFiles" accept=".pdf,.docx,.doc"
                                   multiple style="display:none" onchange="showSelectedFiles()">
                        </div>

                        <div id="selected-files-list" class="mt-3"></div>

                        <div class="mt-3">
                            <label class="form-label text-white-50 small">Job Description</label>
                            <textarea id="rankJobDesc" class="form-control form-control-custom" rows="6"
                                      placeholder="Paste the job description..."></textarea>
                        </div>

                        <button class="btn btn-gradient w-100 mt-3 py-3" onclick="rankResumes()">
                            <i class="fas fa-sort me-2"></i>Rank Resumes
                        </button>
                    </div>
                </div>
            </div>

            <div class="col-lg-7" id="rank-results" style="display:none">
                <div class="card-dark">
                    <div class="card-dark-header">
                        <h6 class="mb-0"><i class="fas fa-medal me-2 text-yellow"></i>Ranking Results</h6>
                    </div>
                    <div class="card-dark-body" id="rank-results-content"></div>
                </div>

                <!-- Ranking Bar Chart -->
                <div class="card-dark mt-4">
                    <div class="card-dark-header">
                        <h6 class="mb-0"><i class="fas fa-chart-bar me-2 text-purple"></i>Score Comparison</h6>
                    </div>
                    <div class="card-dark-body">
                        <canvas id="rankBarChart" height="150"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div><!-- end main-content -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/analyzer.js') }}"></script>
<script>
    // Sidebar toggle
    document.getElementById('sidebarToggle').addEventListener('click', function () {
        document.getElementById('sidebar').classList.toggle('collapsed');
        document.getElementById('mainContent').classList.toggle('expanded');
    });

    // Tab switching
    function switchTab(tab) {
        document.getElementById('panel-single').style.display = tab === 'single' ? 'block' : 'none';
        document.getElementById('panel-rank').style.display   = tab === 'rank'   ? 'block' : 'none';
        document.getElementById('tab-single').classList.toggle('active', tab === 'single');
        document.getElementById('tab-rank').classList.toggle('active', tab === 'rank');
    }

    // Check if we should open rank tab from URL hash
    if (window.location.hash === '#rank') switchTab('rank');
</script>
</body>
</html>
